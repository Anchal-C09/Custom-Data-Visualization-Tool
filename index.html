<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Chart Builder</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#1d4ed8', // Blue
                        'secondary': '#f97316', // Orange
                    }
                }
            }
        }
    </script>
    <style>
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* Style for required input */
        .required-input:invalid:not(:placeholder-shown) {
            border-color: #ef4444; /* red-500 */
            box-shadow: 0 0 0 1px #ef4444;
        }
    </style>
</head>
<body class="font-sans antialiased bg-gray-50 min-h-screen p-4 md:p-8">

    <header class="mb-8 text-center">
        <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight">Custom Data Visualization Tool</h1>
        <p class="text-gray-500 mt-1">Select a chart type and input your data to visualize it instantly.</p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Left Column: Controls and Data Input -->
        <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-2xl h-fit sticky top-8">
            <h2 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">Configuration</h2>
            
            <!-- Chart Type Selector -->
            <div class="mb-6">
                <label for="chartType" class="block text-sm font-medium text-gray-700 mb-2">1. Choose Chart Type</label>
                <select id="chartType" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-primary focus:ring-primary focus:ring-opacity-50 p-3 bg-white text-lg font-semibold" onchange="renderChart()">
                    <option value="" disabled selected>Select a Chart</option>
                    <option value="bar">Bar Chart</option>
                    <option value="line">Line Graph</option>
                    <option value="pie">Pie Chart</option>
                </select>
            </div>

            <!-- Data Input Form -->
            <h3 class="text-lg font-bold text-gray-700 mb-3 border-b pb-1">2. Data Entries</h3>

            <div id="dataInputs" class="space-y-4 mb-4">
                <!-- Initial Data Rows will be inserted here by JS -->
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-col space-y-3">
                <button onclick="addRow()" class="w-full bg-secondary text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-orange-600 transition duration-150">
                    + Add Data Entry
                </button>
                <button onclick="renderChart()" id="renderButton" class="w-full bg-primary text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-blue-800 transition duration-150 opacity-50 cursor-not-allowed" disabled>
                    Render Chart
                </button>
            </div>
        </div>

        <!-- Right Column: Chart Display -->
        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-2xl">
            <h2 id="chartTitle" class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">Chart Visualization</h2>
            
            <div id="chartMessage" class="chart-container text-gray-500 text-center text-lg">
                Please select a chart type and add at least one data entry to start visualizing.
            </div>

            <div id="chartDisplay" class="chart-container hidden">
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </main>

    <script>
        let myChartInstance = null;
        let rowCounter = 0;

        // Default colors for Chart.js visualization
        const defaultColors = [
            '#1d4ed8', '#f97316', '#10b981', '#ef4444', '#3b82f6', 
            '#ca8a04', '#7c3aed', '#db2777', '#0891b2', '#facc15'
        ];

        /**
         * Adds a new row for data entry (name and value).
         */
        function addRow(name = '', value = '') {
            const container = document.getElementById('dataInputs');
            const newRow = document.createElement('div');
            const id = rowCounter++;

            newRow.classList.add('flex', 'space-x-2', 'items-center');
            newRow.id = `row-${id}`;
            newRow.innerHTML = `
                <input type="text" placeholder="Item Name (e.g., Q1, Apples)" value="${name}"
                       id="name-${id}" class="name-input w-2/3 border border-gray-300 rounded-lg p-2 required-input" required oninput="enableRenderButton()">
                <input type="number" placeholder="Value (e.g., 1500)" value="${value}"
                       id="value-${id}" class="value-input w-1/3 border border-gray-300 rounded-lg p-2 required-input" required oninput="enableRenderButton()">
                <button onclick="removeRow(${id})" class="text-red-500 hover:text-red-700 transition duration-150 p-1" title="Remove Entry">
                    &times;
                </button>
            `;
            container.appendChild(newRow);
            
            // Ensure initial rows (if loaded) also trigger the button enablement
            enableRenderButton(); 
        }

        /**
         * Removes a data entry row.
         * @param {number} id - The ID of the row to remove.
         */
        function removeRow(id) {
            const row = document.getElementById(`row-${id}`);
            if (row) {
                row.remove();
                enableRenderButton();
                // Re-render chart if data is removed
                renderChart();
            }
        }

        /**
         * Checks if a chart type is selected and data is available to enable the render button.
         */
        function enableRenderButton() {
            const chartType = document.getElementById('chartType').value;
            const dataRows = document.querySelectorAll('.name-input');
            const isDataValid = Array.from(dataRows).some(input => input.value.trim() !== '');
            
            const renderButton = document.getElementById('renderButton');
            
            if (chartType && isDataValid) {
                renderButton.disabled = false;
                renderButton.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                renderButton.disabled = true;
                renderButton.classList.add('opacity-50', 'cursor-not-allowed');
                // If inputs are cleared or chart type deselected, hide the chart
                if (myChartInstance) {
                    document.getElementById('chartDisplay').classList.add('hidden');
                    document.getElementById('chartMessage').classList.remove('hidden');
                    document.getElementById('chartMessage').textContent = "Please select a chart type and add at least one data entry to start visualizing.";
                }
            }
        }

        /**
         * Collects data from the form and renders the Chart.js chart.
         */
        function renderChart() {
            const chartType = document.getElementById('chartType').value;
            const dataInputs = document.getElementById('dataInputs').querySelectorAll('.flex');
            const renderButton = document.getElementById('renderButton');

            // 1. Validate Input
            if (!chartType || dataInputs.length === 0) {
                return; // Do nothing if not ready
            }

            const chartData = [];
            let isValid = true;
            dataInputs.forEach(row => {
                const nameInput = row.querySelector('.name-input');
                const valueInput = row.querySelector('.value-input');

                const name = nameInput.value.trim();
                const value = parseFloat(valueInput.value);

                if (!name || isNaN(value)) {
                    isValid = false;
                }
                
                chartData.push({ name, value });
            });
            
            const validData = chartData.filter(d => d.name && !isNaN(d.value));

            if (!isValid || validData.length === 0) {
                document.getElementById('chartMessage').textContent = "Please ensure all data entries have a name and a valid number value.";
                document.getElementById('chartDisplay').classList.add('hidden');
                document.getElementById('chartMessage').classList.remove('hidden');
                return;
            }

            // 2. Prepare Chart Data Structure
            const labels = validData.map(d => d.name);
            const values = validData.map(d => d.value);

            let chartConfig;

            if (chartType === 'pie') {
                chartConfig = {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Value',
                            data: values,
                            backgroundColor: labels.map((_, i) => defaultColors[i % defaultColors.length]),
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'right' },
                            title: { display: true, text: 'Proportional Data Distribution' }
                        }
                    }
                };
                document.getElementById('chartTitle').textContent = 'Pie Chart Visualization';

            } else { // Bar or Line
                chartConfig = {
                    type: chartType,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Value',
                            data: values,
                            backgroundColor: chartType === 'bar' ? defaultColors[0] : 'rgba(29, 78, 216, 0.5)',
                            borderColor: defaultColors[0],
                            borderWidth: chartType === 'line' ? 2 : 0,
                            tension: chartType === 'line' ? 0.4 : 0,
                            fill: chartType === 'line' ? true : false,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Value' } },
                            x: { title: { display: true, text: 'Item Name' } }
                        },
                        plugins: {
                            title: { display: true, text: `${chartType === 'line' ? 'Trend Over Items' : 'Item Comparison'}` },
                            legend: { display: false }
                        }
                    }
                };
                document.getElementById('chartTitle').textContent = chartType === 'line' ? 'Line Graph Visualization' : 'Bar Chart Visualization';
            }


            // 3. Destroy old chart and create new one
            if (myChartInstance) {
                myChartInstance.destroy();
            }

            const ctx = document.getElementById('myChart').getContext('2d');
            myChartInstance = new Chart(ctx, chartConfig);

            // 4. Update UI visibility
            document.getElementById('chartMessage').classList.add('hidden');
            document.getElementById('chartDisplay').classList.remove('hidden');
        }

        // --- Initialization ---
        window.onload = function() {
            // Add initial empty rows when the page loads
            addRow('Item A', 1500);
            addRow('Item B', 2200);
            addRow('Item C', 800);
        };

    </script>
</body>
</html>
